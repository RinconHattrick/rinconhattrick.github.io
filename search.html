---
layout: with-sidebar
title: "Resultados de Búsqueda"
description: "Búsqueda de artículos en el sitio"
---

<section class="container">
  <div class="content">
    <header id="main-header">
      <h1 class="title is-2 has-text-centered">Resultados de Búsqueda</h1>
    </header>

    <form class="mt-5" role="search" onsubmit="event.preventDefault()">
      <div class="field">
        <div class="control has-icons-left is-expanded">
          <input
            type="search"
            id="search-input"
            class="input is-rounded"
            placeholder="Buscar artículos..."
            aria-label="Buscar artículos"
            aria-describedby="search-hint"
            autocomplete="off"
          />
          <span class="icon is-small is-left">
            <i class="fas fa-search"></i>
          </span>
        </div>
      </div>
      <p id="search-hint" class="help">
        Escribe al menos 3 caracteres para comenzar a buscar.
      </p>
    </form>

    <div id="search-feedback" class="notification is-hidden mt-3"></div>

    <div id="search-results" class="box mt-5 p-4" aria-live="polite"></div>
  </div>
</section>

<script>
  class SearchManager {
    constructor() {
      this.searchJsonUrl = "{{ '/assets/json/search.json' | relative_url }}";
      this.searchInput = document.getElementById("search-input");
      this.feedbackElement = document.getElementById("search-feedback");
      this.resultsContainer = document.getElementById("search-results");

      this.init();
    }

    init() {
      this.searchInput.addEventListener(
        "input",
        this.debounce((e) => this.search(e.target.value.trim()), 300)
      );

      const queryParams = new URLSearchParams(window.location.search);
      const initialQuery = queryParams.get("q");

      if (initialQuery) {
        this.searchInput.value = initialQuery;
        this.search(initialQuery);
      }
    }

    showFeedback(message, type = "is-primary") {
      this.feedbackElement.textContent = message;
      this.feedbackElement.classList.remove(
        "is-hidden",
        "is-danger",
        "is-primary"
      );
      this.feedbackElement.classList.add(type);
    }

    hideFeedback() {
      this.feedbackElement.classList.add("is-hidden");
    }

    renderResults(results) {
      this.resultsContainer.innerHTML = "";

      if (!results.length) {
        this.resultsContainer.innerHTML = `
          <p class="has-text-danger">No se encontraron resultados.</p>
        `;
        return;
      }

      const ul = document.createElement("ul");
      ul.className = "search-results-list";

      results.forEach((item) => {
        const li = document.createElement("li");
        li.className = "mb-3";
        li.innerHTML = `
          <article>
            <h2 class="is-size-5 mb-2">
              <a href="${item.url}" class="has-text-weight-semibold">
                ${this.highlightMatch(item.title, this.searchInput.value)}
              </a>
            </h2>
            ${
              item.excerpt
                ? `<p class="is-size-6 has-text-grey">${this.truncateText(
                    item.excerpt,
                    150
                  )}</p>`
                : ""
            }
          </article>
        `;
        ul.appendChild(li);
      });

      this.resultsContainer.appendChild(ul);
    }

    highlightMatch(text, query) {
      if (!query) return text;
      const regex = new RegExp(`(${query})`, "gi");
      return text.replace(regex, "<mark>$1</mark>");
    }

    truncateText(text, length) {
      return text.length > length ? text.substring(0, length) + "..." : text;
    }

    debounce(func, wait) {
      let timeout;
      return function (...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    async search(query) {
      if (query.length < 3) {
        this.renderResults([]);
        this.hideFeedback();
        return;
      }

      this.showFeedback("Cargando resultados...");

      try {
        const response = await fetch(this.searchJsonUrl);
        if (!response.ok)
          throw new Error("Error al cargar los datos de búsqueda");

        const data = await response.json();
        if (!Array.isArray(data))
          throw new Error("Formato incorrecto de datos");

        const results = data.filter((item) =>
          item.title.toLowerCase().includes(query.toLowerCase())
        );

        this.renderResults(results);
        this.hideFeedback();
      } catch (error) {
        console.error(error);
        this.showFeedback(
          "No se pudieron obtener los resultados. Inténtalo más tarde.",
          "is-danger"
        );
      }
    }
  }

  document.addEventListener("DOMContentLoaded", () => new SearchManager());
</script>
