---
layout: with-sidebar
title: "Resultados de Búsqueda"
---

<section class="container" role="main">
  <div class="content">
    <h1 class="title has-text-centered" role="heading" aria-level="1">
      Resultados de Búsqueda
    </h1>

    <div class="field has-addons mt-5">
      <div class="control is-expanded">
        <input
          type="text"
          id="search-input"
          class="input is-rounded"
          placeholder="Buscar artículos..."
          aria-label="Buscar artículos"
          aria-describedby="search-hint"
        />
      </div>
    </div>
    <p id="search-hint" class="help">
      Escribe al menos 3 caracteres para comenzar a buscar.
    </p>

    <div
      id="search-feedback"
      class="notification is-primary is-hidden mt-3"
    ></div>

    <div
      id="search-results"
      class="box mt-5"
      aria-live="polite"
      role="region"
    ></div>
  </div>
</section>

<script>
  const searchJsonUrl = "{{ '/assets/json/search.json' | relative_url }}";

  function showFeedback(message, type = "is-primary") {
    const feedback = document.getElementById("search-feedback");
    feedback.textContent = message;
    feedback.className = `notification ${type}`;
    feedback.classList.remove("is-hidden");
  }

  function hideFeedback() {
    const feedback = document.getElementById("search-feedback");
    feedback.classList.add("is-hidden");
  }

  function renderResults(results) {
    const resultsContainer = document.getElementById("search-results");
    resultsContainer.innerHTML = "";

    if (results.length === 0) {
      resultsContainer.innerHTML = `<p class="has-text-danger">No se encontraron resultados.</p>`;
      return;
    }

    const ul = document.createElement("ul");
    ul.className = "search-results-list";
    ul.setAttribute("role", "list");

    results.forEach((item) => {
      const li = document.createElement("li");
      li.innerHTML = `
        <a href="${item.url}" aria-label="Leer artículo: ${item.title}" class="has-text-link">
          ${item.title}
        </a>
      `;
      ul.appendChild(li);
    });

    resultsContainer.appendChild(ul);
  }

  function debounce(func, wait) {
    let timeout;
    return function (...args) {
      const context = this;
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(context, args), wait);
    };
  }

  async function search(query) {
    if (query.length < 3) {
      renderResults([]);
      hideFeedback();
      return;
    }

    showFeedback("Cargando resultados...", "is-primary");

    try {
      const response = await fetch(searchJsonUrl);
      if (!response.ok) {
        throw new Error("No se pudo cargar el archivo de búsqueda.");
      }
      const data = await response.json();
      const results = data.filter((item) =>
        item.title.toLowerCase().includes(query.toLowerCase().trim())
      );

      renderResults(results);
      hideFeedback();
    } catch (error) {
      console.error(error);
      showFeedback(
        "Ocurrió un error al buscar. Por favor, intenta más tarde.",
        "is-danger"
      );
    }
  }

  function initSearch() {
    const searchInput = document.getElementById("search-input");

    searchInput.addEventListener(
      "input",
      debounce((e) => search(e.target.value.trim()), 300)
    );

    const queryParams = new URLSearchParams(window.location.search);
    const initialQuery = queryParams.get("q") || "";

    if (initialQuery) {
      searchInput.value = initialQuery;
      search(initialQuery);
    }
  }

  document.addEventListener("DOMContentLoaded", initSearch);
</script>

<style></style>
