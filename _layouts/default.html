<!DOCTYPE html>
<html lang="{{ page.lang | default: 'es' }}" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="robots" content="index, follow" />

    <!-- Theme Color -->
    <meta name="theme-color" content="#00d1b2" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#181825" media="(prefers-color-scheme: dark)" />
    <meta name="color-scheme" content="light dark" />

    {% seo %}

    <!-- Icono -->
    <link rel="icon" href="{{ '/assets/img/favicon.ico' | relative_url }}" sizes="any" />

    <!-- Precargas críticas -->
    <link rel="preload" href="{{ '/assets/main.css' | relative_url }}" as="style" />
    <link rel="preload" href="{{ '/assets/js/script.js' | relative_url }}" as="script" />

    <!-- Preconexión optimizada -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />

    <!-- CSS Critical -->
    <style>
      /* Aquí va el CSS crítico para el contenido above the fold */
      .navbar-fixed-top {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 30;
      }
      .container {
        max-width: 1344px;
        margin: 0 auto;
        padding: 1rem;
      }
      .columns {
        display: flex;
        margin-left: -0.75rem;
        margin-right: -0.75rem;
        margin-top: -0.75rem;
      }
      .column {
        padding: 0.75rem;
      }
    </style>

    <!-- CSS No crítico con carga diferida -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css" media="print" onload="this.media='all'" />

    <!-- Font Awesome optimizado (solo los iconos necesarios) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/fontawesome.min.css"
      media="print"
      onload="this.media='all'"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/solid.min.css"
      media="print"
      onload="this.media='all'"
    />

    <!-- Estilos personalizados con versionado -->
    <link rel="stylesheet" href="{{ '/assets/main.css?v=2.0.0' | relative_url }}" media="print" onload="this.media='all'" />

    <!-- Fallback para navegadores sin JavaScript -->
    <noscript>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/fontawesome.min.css" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/solid.min.css" />
      <link rel="stylesheet" href="{{ '/assets/main.css?v=2.0.0' | relative_url }}" />
    </noscript>
  </head>

  <body class="has-navbar-fixed-top">
    {% include header.html %}
    <div class="container">
      <div class="columns is-gapless">
        <main class="column is-full-touch is-three-quarters-desktop">{{ content }}</main>
        {% if page.layout != "no-sidebar" %}
        <section class="column is-hidden-touch is-one-quarter-desktop">{% include aside.html %}</section>
        {% endif %}
      </div>
    </div>
    {% include footer.html %}

    <!-- Botón de scroll optimizado -->
    <button class="scroll-to-top-btn" id="scrollToTopBtn" title="Subir" aria-label="Subir al inicio" hidden>
      <i class="fas fa-arrow-up" aria-hidden="true"></i>
    </button>

    <!-- Scripts optimizados -->
    <script>
      // Inline del script crítico para carga de imágenes
      document.addEventListener("DOMContentLoaded", function () {
        const images = document.querySelectorAll(".image img");
        const loadImage = (img) => {
          if (img.complete) {
            img.parentElement?.classList.add("is-loaded");
          }
        };

        const observerCallback = (entries, observer) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              loadImage(entry.target);
              observer.unobserve(entry.target);
            }
          });
        };

        const imageObserver = new IntersectionObserver(observerCallback, {
          rootMargin: "50px 0px",
        });

        images.forEach((img) => {
          imageObserver.observe(img);

          img.addEventListener("load", function () {
            this.parentElement?.classList.add("is-loaded");
          });

          img.addEventListener("error", function () {
            this.classList.add("has-error");
            this.src = "/assets/img/RinconHattrick.jpg";
          });
        });
      });
    </script>

    <!-- Script principal diferido -->
    <script src="{{ '/assets/js/script.js?v=2.0.0' | relative_url }}" defer></script>
  </body>
</html>
